# .github/workflows/deploy.yml

# å·¥ä½œæµç¨‹çš„åç¨±
name: Deploy Vue App to GitHub Pages

# è§¸ç™¼æ¢ä»¶ï¼šç•¶æ¨é€åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼
on:
  push:
    branches:
      - main # å¦‚æœä½ çš„ä¸»è¦åˆ†æ”¯æ˜¯ masterï¼Œè«‹æ”¹ç‚º master

# å…è¨±æ­¤å·¥ä½œæµç¨‹å¯«å…¥ GitHub Pages çš„éƒ¨ç½²
permissions:
  contents: read
  pages: write
  id-token: write

# å·¥ä½œæµç¨‹åŸ·è¡Œçš„ä»»å‹™
jobs:
  # å®šç¾©ä¸€å€‹åç‚º 'build-and-deploy' çš„ä»»å‹™
  build-and-deploy:
    # ä»»å‹™é‹è¡Œçš„ç’°å¢ƒ
    runs-on: ubuntu-latest

    # ä»»å‹™çš„æ­¥é©Ÿ
    steps:
      # æ­¥é©Ÿä¸€ï¼šæ‹‰å–ç¨‹å¼ç¢¼  æº–å‚™éšæ®µ
      # ä½¿ç”¨å®˜æ–¹çš„ checkout action
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # æ­¥é©ŸäºŒï¼šè¨­å®š Node.js ç’°å¢ƒ
      # ä½¿ç”¨å®˜æ–¹çš„ setup-node action
      - name: Set up Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: "18" # å»ºè­°ä½¿ç”¨ä¸€å€‹ LTS (é•·æœŸæ”¯æ´) ç‰ˆæœ¬
          cache:
            "npm" # ç‚º npm è¨­å®šå¿«å–ï¼ŒåŠ é€Ÿå¾ŒçºŒåŸ·è¡Œ
            # ã€é‡è¦ã€‘æ–°å¢é€™ä¸€è¡Œï¼Œå‘Šè¨´ action å»å“ªè£¡æ‰¾ lock æª”æ¡ˆ
          cache-dependency-path: frontend/package-lock.json

      # æ­¥é©Ÿä¸‰ï¼šå®‰è£å°ˆæ¡ˆä¾è³´ å»ºç½®éšæ®µ
      - name: Install dependencies ğŸ‘¨â€ğŸ”§
        run: npm ci # ä½¿ç”¨ npm ci æœƒæ¯” npm install æ›´å¿«ã€æ›´å¯é 
        working-directory: ./frontend

      # æ­¥é©Ÿå››ï¼šå»ºç½®å°ˆæ¡ˆ
      # npm run build æœƒåŸ·è¡Œ package.json ä¸­ "scripts" è£¡çš„ "build" æŒ‡ä»¤
      - name: Build ğŸ—ï¸
        run: npm run build
        working-directory: ./frontend

      # æ­¥é©Ÿäº”ï¼šè¨­å®š GitHub Pages éƒ¨ç½²éšæ®µ
      - name: Setup Pages
        uses: actions/configure-pages@v4

      # æ­¥é©Ÿå…­ï¼šä¸Šå‚³å»ºç½®å¥½çš„ç”¢ç‰© (artifact)
      # é è¨­æƒ…æ³ä¸‹ï¼ŒVite æœƒå°‡å»ºç½®å¥½çš„æª”æ¡ˆæ”¾åœ¨ dist è³‡æ–™å¤¾
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: "./frontend/dist"

      # æ­¥é©Ÿä¸ƒï¼šéƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages ğŸš€
        id: deployment
        uses: actions/deploy-pages@v4
